// src/app/page.tsx 'use client';

import { useState } from 'react'; import { Button } from "@/components/ui/button"; import { Input } from "@/components/ui/input"; import { Textarea } from "@/components/ui/textarea"; import { Card, CardContent } from "@/components/ui/card"; import { Loader2, Music } from "lucide-react"; import { motion } from 'framer-motion';

export default function Page() { const [title, setTitle] = useState("Mystic Flute Ceremony"); const [prompt, setPrompt] = useState("shamanic flute ambient tribal mystic"); const [tags, setTags] = useState("shamanic, tribal, ambient"); const [isInstrumental, setIsInstrumental] = useState(true); const [loading, setLoading] = useState(false); const [taskId, setTaskId] = useState<string | null>(null); const [audioUrl, setAudioUrl] = useState<string | null>(null);

const generateMusic = async () => { setLoading(true); setAudioUrl(null);

const res = await fetch("/api/generate", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ title, prompt, tags, instrumental: isInstrumental })
});

const data = await res.json();
if (!data.task_id) return alert("Erreur : t√¢che non cr√©√©e");

setTaskId(data.task_id);
pollStatus(data.task_id);

};

const pollStatus = async (id: string) => { const interval = setInterval(async () => { const res = await fetch(/api/status/${id}); const data = await res.json(); if (data.status === 'complete') { clearInterval(interval); setAudioUrl(data.audio_url); setLoading(false); } }, 5000); };

return ( <div className="min-h-screen bg-gradient-to-br from-white to-blue-100 p-4"> <motion.div className="max-w-xl mx-auto mt-8 space-y-6" initial={{ opacity: 0 }} animate={{ opacity: 1 }}> <h1 className="text-3xl font-bold text-center flex items-center gap-2 justify-center"> <Music className="w-6 h-6" /> Test G√©n√©rateur Suno </h1> <Input placeholder="Titre" value={title} onChange={(e) => setTitle(e.target.value)} /> <Textarea placeholder="Prompt musical" value={prompt} onChange={(e) => setPrompt(e.target.value)} /> <Input placeholder="Tags" value={tags} onChange={(e) => setTags(e.target.value)} /> <div className="flex items-center space-x-2"> <input type="checkbox" checked={isInstrumental} onChange={() => setIsInstrumental(!isInstrumental)} /> <label>Instrumental</label> </div> <Button className="w-full" onClick={generateMusic} disabled={loading}> {loading ? (<><Loader2 className="animate-spin mr-2 h-4 w-4" /> G√©n√©ration...</>) : "G√©n√©rer la musique"} </Button>

{audioUrl && (
      <Card>
        <CardContent className="p-4 space-y-4">
          <p className="font-semibold">üéß R√©sultat :</p>
          <audio controls className="w-full">
            <source src={audioUrl} type="audio/mpeg" />
          </audio>
        </CardContent>
      </Card>
    )}
  </motion.div>
</div>

); }

